import { createClientComponentClient } from "@supabase/auth-helpers-nextjs"; import { NextResponse } from "next/server"; export async function GET(request) { try { const supabase = createClientComponentClient(); const { data: { session } } = await supabase.auth.getSession(); if (!session) { return NextResponse.json({ error: "Unauthorized" }, { status: 401 }); } const { data: opportunities, error } = await supabase.from("cross_promotion_opportunities").select("id, newsletter_name, description, category, subscribers, revenue_per_click, budget, duration, target_audience, requirements, status, created_at, user_id").eq("status", "active").neq("user_id", session.user.id).order("created_at", { ascending: false }); if (error) { return NextResponse.json({ error: "Failed to fetch opportunities" }, { status: 500 }); } return NextResponse.json({ success: true, opportunities: opportunities || [] }); } catch (error) { return NextResponse.json({ error: "Internal server error" }, { status: 500 }); } }
